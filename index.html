<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive Map with Draw + Clipboard</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />

  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #copy-notice {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #4caf50;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-family: sans-serif;
      display: none;
      z-index: 1000;
    }

    .leaflet-div-icon {
      width: 3px !important;
      height: 3px !important;
      margin-left: -2px !important;
      margin-top: -2px !important;
      border-radius: 2px !important;
      border: 1px solid #000;
      background: #fff;
    }
  </style>
</head>
<body>

<div id="copy-notice">Coordinates copied to clipboard!</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
  
<script>
  var map = L.map('map').setView([1.2966, 103.7764], 16);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);
  
  L.control.scale().addTo(map);
  const COLOR_GREEN = '#2cff05';   // Not stressful
  const COLOR_YELLOW = '#FFFF00';  // Slightly stressful
  const COLOR_RED = '#F54927';     // Very stressful
  const COLOR_MOUSEOVER = '#ff7800' 
    
  function generateStressBar(rating, total = 5) {
    let bar = '';
    for (let i = 0; i < total; i++) {
      bar += `<span style="display:inline-block;width:15px;height:15px;
        background:${i < rating ? '#f44336' : '#ccc'};
        margin-right:2px;border-radius:2px;"></span>`;
    }
    return bar;
  }
  
  //Central Library
  var polygon1 = L.polygon([
    [1.2970537610730943, 103.77367373113053],
    [1.2972307415033832, 103.77373808736458],
    [1.297139569768121, 103.77399551230079],
    [1.2970323088988829, 103.77395797116424],
    [1.297016219768113, 103.77399014928127],
    [1.2966086284209712, 103.77383998473516],
    [1.2967266153966337, 103.77352356658444],
    [1.2966783479981665, 103.77351284054542],
    [1.296705163219649, 103.77344312129186],
    [1.2966247175543364, 103.77341630619435],
    [1.2966086284209712, 103.77347529940891],
    [1.2964638262160655, 103.77341630619435],
    [1.2964799153503597, 103.77328223070677],
    [1.2960347825973366, 103.77312670314112],
    [1.2961956739628837, 103.77267084648332],
    [1.2966568958207743, 103.77283173706846],
    [1.2966354436432042, 103.77290145632199],
    [1.296694437131099, 103.7729175453805],
    [1.2966890740867925, 103.77294972349752],
    [1.2966408066876127, 103.772933634439],
    [1.2966461697320084, 103.77296044953653],
    [1.2968124241027414, 103.77304089482908],
    [1.2968231501908078, 103.77300335369254],
    [1.2967427045292483, 103.77297653859502],
    [1.2967909719264816, 103.77285855216597],
    [1.2969894045499128, 103.77292827141949],
    [1.296967952375167, 103.77300871671206],
    [1.297107391507828, 103.7730623469071],
    [1.2970859393340743, 103.77313206616063],
    [1.297209289330673, 103.77318569635568],
    [1.297182474114534, 103.77328223070677],
    [1.2972146523738728, 103.77329831976529],
    [1.2971985632442606, 103.77335194996029],
    [1.2972253784602343, 103.77336803901882],
    [1.2971502958547878, 103.77358792281846],
    [1.2970913023775286, 103.77357183375999]
  ], {
    color: '#000000',
    fillColor: COLOR_YELLOW,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon1.bindPopup(
    `<b>Central Library</b><br> A conducive place for studying. Gets busier as project deadlines and exams loom closer.<br><br>
     <img src="images/central-library.jpg" alt="Central Library" style="width: 200px; border-radius: 8px; margin-bottom: 8px;" /><br>
     <b>Stress Rating:</b><br> ${generateStressBar(3, 5)}<br>
     <b>Average Time Spent</b>: X hours/week`
  );

  polygon1.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER });
    this.openPopup();
  });

  polygon1.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_YELLOW});
    this.closePopup();
  });
  
  //Mochtar Riady Building
  var polygon2 = L.polygon([
    [1.2926406682847937, 103.77376019954683],
    [1.2927318139513266, 103.77394258975984],
    [1.2926621143242878, 103.77417325973512],
    [1.2925709686552487, 103.77443075180055],
    [1.2923297006920422, 103.77452731132509],
    [1.2922760855859792, 103.77439320087433],
    [1.2923618697551127, 103.77413570880891],
    [1.2923404237131124, 103.77404987812042],
    [1.2924959075135973, 103.7738084793091]
  ], {
    color: '#000000',
    fillColor: COLOR_RED,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon2.bindPopup(
    `<b>Mochtar Riady Building</b><br>A glass building where lectures and tutorials are conducted.<br><br>
     <b>Stress Rating:</b><br> ${generateStressBar(4, 5)}<br>
     <b>Average Time Spent</b>: X hours/week`
  );

  polygon2.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });

  polygon2.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_RED});
    this.closePopup();
  });

  //The Deck
  var polygon3 = L.polygon([
    [1.2948441861747249, 103.77265985332583],
    [1.2948763644637828, 103.7727188465404],
    [1.2947959187403935, 103.77277247673544],
    [1.2947422882567174, 103.77268130540386],
    [1.2946403903346138, 103.77267057936486],
    [1.2945921228963895, 103.77262231218933],
    [1.2945224032617915, 103.77269203144289],
    [1.2944580466743119, 103.77263840124785],
    [1.2944205053308457, 103.7725740450138],
    [1.294399053134345, 103.7724292434872],
    [1.2945331293595521, 103.77219863364853],
    [1.2946350272859688, 103.77228444196058],
    [1.2946993838689702, 103.77225761147929],
    [1.294645753383246, 103.77216107712822],
    [1.2946028489938575, 103.77218252920622],
    [1.2945116771639928, 103.7721181729722],
    [1.2945545815549335, 103.77210208391367],
    [1.2945331293595521, 103.77204309069913],
    [1.2947315621598474, 103.77194119332853],
    [1.2947851926437397, 103.7720323646601],
    [1.2947691034986955, 103.77204845371863],
    [1.2949514471366317, 103.77247749527896]
  ], {
    color: '#000000',
    fillColor: COLOR_GREEN,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon3.bindPopup(
    `<b>The Deck</b><br> A nice food hotspot!<br><br>
     <b>Stress Rating:</b><br> ${generateStressBar(1, 5)}<br>
     <b>Average Time Spent</b>: X hours/week`
  );

  polygon3.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });

  polygon3.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_GREEN});
    this.closePopup();
  });

  //Shaw Foundation Building
  var polygon4 = L.polygon([ 
  [1.2944526836252725, 103.77205893641414], 
  [1.2942864290996847, 103.77168888806838], 
  [1.2939914613661614, 103.7715869906978], 
  [1.2940021874661738, 103.77154408654175], 
  [1.2939271047652217, 103.77151190842476], 
  [1.2938627481626281, 103.77168888806838], 
  [1.294179168109649, 103.77181223751695], 
  [1.29420062030802, 103.77185514167299], 
  [1.2940719071150844, 103.77194119332853], 
  [1.2941001598098975, 103.77201627571204], 
  [1.2943366801449324, 103.7721406251606]
  ], {
    color: '#000000',
    fillColor: COLOR_YELLOW,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon4.bindPopup(
    `<b>Shaw Foundation Building</b><br> A place for medical and science classes.<br><br>
     <b>Stress Rating:</b><br> ${generateStressBar(2, 5)}<br>
     <b>Average Time Spent</b>: X hours/week`
  );

  polygon4.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });

  polygon4.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_YELLOW});
    this.closePopup();
  });
  
  var polygon5 = L.polygon([
  [1.2929242141893083, 103.77475798130035],
  [1.2926989659840635, 103.77431809902193],
  [1.2928866728231585, 103.77422153949739],
  [1.2929081250324579, 103.77426445484163],
  [1.2929671186070801, 103.77423763275146],
  [1.292951029450497, 103.77416253089906],
  [1.2930851057522408, 103.7740981578827],
  [1.2931065579598608, 103.774151802063],
  [1.2931280101672902, 103.77413570880891],
  [1.2931923667885217, 103.77424836158752],
  [1.2932781756142946, 103.77424836158752],
  [1.2933318061289238, 103.77437710762025],
  [1.2932942647687915, 103.77440929412843],
  [1.2932728125627617, 103.77438247203827],
  [1.2931923667885217, 103.77442002296449],
  [1.2931816406850998, 103.77439320087433],
  [1.293117284063601, 103.77442002296449],
  [1.2932352712017645, 103.77469897270204],
  [1.2930904688041682, 103.77477407455446],
  [1.293069016596408, 103.77473115921022],
  [1.2930046599720468, 103.77476871013641],
  [1.2929778447114182, 103.77473652362823]
  ], {
    color: '#000000',
    fillColor: COLOR_YELLOW,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon5.bindPopup(
    `<b>Hon Sui Sen Memorial Library</b><br> An air-conditioned area with plenty of studying spots. Sometimes classes are held here as well.<br><br>
     <b>Stress Rating:</b><br> ${generateStressBar(3, 5)}<br>
     <b>Average Time Spent</b>: X hours/week`
  );

  polygon5.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });

  polygon5.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_YELLOW});
    this.closePopup();
  });

  var polygon6 = L.polygon([
  [1.3005236478557476, 103.77045571804048],
  [1.3007542584003482, 103.77053618431093],
  [1.3005451000003163, 103.77107262611389],
  [1.3003413046195027, 103.77100288867952],
  [1.3002984003267268, 103.77099752426149],
  [1.300330578546385, 103.77092778682709],
  [1.3002179547757744, 103.77087950706483],
  [1.3001750504808738, 103.77095460891725],
  [1.3002286808493755, 103.77106189727783],
  [1.3001696874439588, 103.77120673656465],
  [1.299965892032841, 103.77113699913026],
  [1.3000141593685495, 103.77091705799103],
  [1.300116057074223, 103.77094388008119],
  [1.30015359833315, 103.77086341381074],
  [1.300110694037168, 103.7708204984665],
  [1.2999444398833613, 103.77091169357301],
  [1.2999015355838173, 103.77087950706483],
  [1.2998425421707671, 103.77091705799103],
  [1.2998050009071964, 103.77082586288454],
  [1.2999980702567484, 103.77072393894197],
  [1.2999068986213047, 103.77051472663881],
  [1.299821090020219, 103.77054691314699],
  [1.2997620966052732, 103.77039670944214],
  [1.2997889117940595, 103.77037525177002],
  [1.2998103639448748, 103.7704074382782],
  [1.2998371791331396, 103.7704074382782],
  [1.2998157269825659, 103.77036452293396],
  [1.2999229877336784, 103.77031087875368],
  [1.3004646544572263, 103.77049863338472]
  ], {
    color: '#000000',
    fillColor: COLOR_GREEN,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon6.bindPopup(
    `<b>CDE BUZZy Kitchen</b><br> A conducive place for relaxation and studying.<br><br>
     <b>Stress Rating:</b><br> ${generateStressBar(1, 5)}<br>
     <b>Average Time Spent</b>: X hours/week`
  );

  polygon6.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });

  polygon6.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_GREEN});
    this.closePopup();
  });

  //University Health Centre
  var polygon7 = L.polygon([
  [1.2992847861974202, 103.77618951312864],
  [1.2991292580674962, 103.77613587942287],
  [1.29906490159715, 103.77626996368721],
  [1.2989951820857542, 103.77624851020497],
  [1.2989415516910703, 103.77633968750466],
  [1.2990112712039419, 103.77636650435755],
  [1.298973729928018, 103.77647913513957],
  [1.2988771952159277, 103.776436228175],
  [1.2988128387391695, 103.77663467288623],
  [1.299048812479306, 103.77670976007423],
  [1.2991614363020652, 103.77643086480441],
  [1.2992847861974202, 103.77646304502787],
  [1.2992955122749905, 103.77636650435755],
  [1.2992311558088683, 103.77633432413411]
  ], {
    color: '#000000',
    fillColor: COLOR_YELLOW,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);
  
  polygon7.bindPopup(`
    <b>University Health Centre</b><br> Place to visit when falling sick ð Most of the time caused by stress.<br><br>
    <b>Stress Rating:</b><br> ${generateStressBar(3, 5)}<br>
    <b>Average Time Spent</b>: X hours/week
  `);
  
  polygon7.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });
  polygon7.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_YELLOW});
    this.closePopup();
  });

  //Education Resources Centre
  var polygon8 = L.polygon([
  [1.3054040060422802, 103.77305688992108],
  [1.305473725376392, 103.77298180273306],
  [1.3055219926065698, 103.77273508768668],
  [1.305607801013489, 103.77267072723981],
  [1.3057150615180322, 103.77269218072209],
  [1.3058008699183614, 103.77262782027523],
  [1.3058330480677294, 103.77255809645776],
  [1.3060958362721726, 103.77257418656947],
  [1.3062299118760903, 103.77267072723981],
  [1.306299631187302, 103.77264927375751],
  [1.3065195151561302, 103.77282626498642],
  [1.3065302412029, 103.77288526206272],
  [1.3065141521327388, 103.77292816902731],
  [1.3064390698039117, 103.77293889576848],
  [1.3063639874728452, 103.77308370677395],
  [1.3063425353778424, 103.77309979688567],
  [1.3061494665145845, 103.77301398295651],
  [1.306106562320749, 103.77306761666222],
  [1.3061011992964546, 103.7730890701445],
  [1.3057686917685862, 103.77326606137345],
  [1.3056667942915565, 103.77304616317991],
  [1.3056721573167671, 103.77321242766769],
  [1.3054576362994625, 103.77328215148515]
  ], {
    color: '#000000',
    fillColor: COLOR_YELLOW,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon8.bindPopup(`
    <b>Education Resources Centre</b><br> Going together with friends to study / revise. A certain extent of stress because the main aim is to study. But still had a lot of fun for the activities, shops and nice views there.<br><br>
    <b>Stress Rating:</b><br> ${generateStressBar(2, 5)}<br>
    <b>Average Time Spent</b>: X hours/week
  `);

  polygon8.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });

  polygon8.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_YELLOW});
    this.closePopup();
  });
  
  //The Terrace (Canteen)
  var polygon9 = L.polygon([
  [1.2944634097233259, 103.77420997793332],
  [1.2945277663106782, 103.7742957918625],
  [1.2946189381399704, 103.7743118819742],
  [1.2946886577719092, 103.7743816057917],
  [1.2947101099659675, 103.77450496331485],
  [1.2946886577719092, 103.77460686735571],
  [1.2946350272859688, 103.77466050106149],
  [1.2945813967988833, 103.77464977432031],
  [1.2945116771639928, 103.7746122307263],
  [1.2944419575271813, 103.7746015039852],
  [1.2943829639868454, 103.77457468713229],
  [1.2943186073958162, 103.77456396039115],
  [1.2942542508031587, 103.7745585970206],
  [1.29420062030802, 103.77456396039115],
  [1.2941738050600244, 103.7745371435383],
  [1.2941630789607625, 103.77451569005599],
  [1.2940772701649124, 103.77454787027942],
  [1.2939968244161677, 103.77434406219766],
  [1.2943615117900138, 103.77416707096873]
  ], {
    color: '#000000',
    fillColor: COLOR_GREEN,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon9.bindPopup(
    `<b>The Terrace (Canteen)</b><br> Good place to have lunch with friends (especially those from COM). near to both COM and biz. A lot of memories with friends with little stress. <br><br>
     <b>Stress Rating:</b><br> ${generateStressBar(1, 5)}<br>
     <b>Average Time Spent</b>: X hours/week`
  );

  polygon9.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });

  polygon9.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_GREEN});
    this.closePopup();
  });

  //Medicine+Science Library
  var polygon10 = L.polygon([
  [1.2954180322680833, 103.7816083431244],
  [1.295455573596766, 103.78147423267366],
  [1.2953000452314685, 103.78139913082123],
  [1.2952410517110937, 103.78150105476381],
  [1.29506943418948, 103.78145277500154],
  [1.294978262376396, 103.7816995382309],
  [1.295064071141751, 103.7816995382309],
  [1.2950265298072667, 103.78193557262422],
  [1.2954019431270465, 103.78199458122255],
  [1.295514567112141, 103.78191947937012],
  [1.295627191092223, 103.78173708915712]
  ], {
    color: '#000000',
    fillColor: COLOR_YELLOW,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);
  
  polygon10.bindPopup(`
    <b>Medicine+Science Library</b><br> The atmosphere is very serious and tense as there are many smart students studying. This motivates me to lock in.<br><br>
    <b>Stress Rating:</b><br> ${generateStressBar(3, 5)}<br>
    <b>Average Time Spent</b>: X hours/week
  `);
  
  polygon10.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });
  polygon10.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_YELLOW});
    this.closePopup();
  });

//UTown
  var polygon11 = L.polygon([
    [1.2926406682847937, 103.77376019954683],
    [1.2927318139513266, 103.77394258975984],
    [1.2926621143242878, 103.77417325973512],
    [1.2925709686552487, 103.77443075180055],
    [1.2923297006920422, 103.77452731132509],
    [1.2922760855859792, 103.77439320087433],
    [1.2923618697551127, 103.77413570880891],
    [1.2923404237131124, 103.77404987812042],
    [1.2924959075135973, 103.7738084793091]
  ], {
    color: '#000000',
    fillColor: COLOR_RED,
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon11.bindPopup(
    `<b>UTown</b><br><br><br>
     <b>Stress Rating:</b><br> ${generateStressBar(5, 5)}<br>
     <b>Average Time Spent</b>: X hours/week`
  );

  polygon11.on('mouseover', function () {
    this.setStyle({ fillColor: COLOR_MOUSEOVER});
    this.openPopup();
  });

  polygon11.on('mouseout', function () {
    this.setStyle({ fillColor: COLOR_RED});
    this.closePopup();
  });
  
  //Business Image
    var businessIcon = L.divIcon({
    html: `
      <img id="business-icon" 
           src="images/business.png" 
           style="
             width: 60px;
             height: 40px;
             transition: opacity 0.8s ease, transform 0.8s ease;
             transform-origin: center;
             opacity: 1;
             transform: scale(1);
           ">
    `,
    iconSize: [60, 40],
    iconAnchor: [30, 20],
    className: '' // remove default Leaflet styling
  });
  
  var businessMarker = L.marker(
    [1.2925332282401272, 103.77416253089906], 
    { icon: businessIcon }
  ).addTo(map);
  
  map.on('zoomend', function () {
    var currentZoom = map.getZoom();
    var img = document.getElementById('business-icon');
    if (img) {
      if (currentZoom > 17) {
        img.style.opacity = '0';
        img.style.transform = 'scale(0.8)';
      } else {
        img.style.opacity = '1';
        img.style.transform = 'scale(1)';
      }
    }
  });



  
  // Leaflet Draw Setup
  var drawnItems = new L.FeatureGroup();
  map.addLayer(drawnItems);

  var drawControl = new L.Control.Draw({
    draw: {
      polygon: {
        allowIntersection: false,
        showArea: true,
        shapeOptions: {
          color: '#FF0000',
          fillColor: '#FFA07A',
          fillOpacity: 0.5
        }
      },
      polyline: false,
      rectangle: false,
      circle: false,
      marker: false,
      circlemarker: false
    },
    edit: false 
  });
  
    map.addControl(drawControl);
  
    // Handle drawing completion
    map.on(L.Draw.Event.CREATED, function (event) {
      var layer = event.layer;
      drawnItems.addLayer(layer);
  
      var latlngs = layer.getLatLngs()[0];
  
      var formattedCoords = latlngs.map(function(latlng) {
        return `[${latlng.lat}, ${latlng.lng}]`;
      });
  
      var result = `[\n  ${formattedCoords.join(',\n  ')}\n]`;
  
      copyToClipboard(result);
      console.log("Copied Polygon Coordinates:\n", result);
    });
  
    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(function () {
        showNotice();
      }).catch(function (err) {
        alert('Failed to copy coordinates: ' + err);
      });
    }
  
    function showNotice() {
      var notice = document.getElementById('copy-notice');
      notice.style.display = 'block';
      setTimeout(() => {
        notice.style.display = 'none';
      }, 2000);
    }

    const legend = L.control({ position: 'bottomright' });
    legend.onAdd = function () {
    const div = L.DomUtil.create('div', 'info legend');
    div.innerHTML = `
      <b>Stress Levels</b><br>
      <i style="background:${COLOR_GREEN};width:18px;height:18px;display:inline-block;margin-right:5px;border-radius:3px;"></i> Not Stressful<br>
      <i style="background:${COLOR_YELLOW};width:18px;height:18px;display:inline-block;margin-right:5px;border-radius:3px;"></i> Moderately Stressful<br>
      <i style="background:${COLOR_RED};width:18px;height:18px;display:inline-block;margin-right:5px;border-radius:3px;"></i> Very Stressful
    `;
    div.style.background = 'white';
    div.style.padding = '8px';
    div.style.borderRadius = '5px';
    div.style.fontFamily = 'sans-serif';
    div.style.fontSize = '13px';
    div.style.lineHeight = '22px';
    div.style.boxShadow = '0 0 5px rgba(0,0,0,0.3)';
    return div;
  };
  legend.addTo(map);
</script>
</body>
</html>
