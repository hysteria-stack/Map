<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive Map with Draw + Clipboard</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />

  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    #copy-notice {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #4caf50;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-family: sans-serif;
      display: none;
      z-index: 1000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    #view-infographic {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 1000;
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      background-color: #2196f3;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    #view-infographic:hover {
      background-color: #1976d2;
      transform: translateY(-2px);
    }

    .leaflet-div-icon {
      width: 3px !important;
      height: 3px !important;
      margin-left: -2px !important;
      margin-top: -2px !important;
      border-radius: 2px !important;
      border: 1px solid #000;
      background: #fff;
    }

    .custom-popup {
      border-radius: 10px;
      padding: 10px;
      box-shadow: 3px 3px 10px rgba(0,0,0,0.3);
      font-size: 14px;
      line-height: 1.3;
      min-width: 200px;
    }

    .stars {
      font-size: 14px;
    }

    .stars span {
      color: gold;
    }
  </style>
</head>
<body>
<button id="view-infographic">View Infographic</button>
<div id="copy-notice">Coordinates copied to clipboard!</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>

<script>
  // Initialize map
  var map = L.map('map').setView([1.2966, 103.7764], 16);

  // Nice light tiles
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; OpenStreetMap &copy; CARTO',
    subdomains: 'abcd',
    maxZoom: 19
  }).addTo(map);

  // Function to generate colored stars
  function generateStars(rating) {
    let fullStars = '★'.repeat(rating);
    let emptyStars = '☆'.repeat(5 - rating);
    return `<span class="stars" style="color:${rating <= 2 ? 'green' : rating===3?'orange':'red'};">${fullStars}</span>${emptyStars}`;
  }

  // Polygon definitions
  var polygons = [
    {
      coords: [
        [1.2970537610730943, 103.77367373113053],
        [1.2972307415033832, 103.77373808736458],
        [1.297139569768121, 103.77399551230079],
        [1.2970323088988829, 103.77395797116424],
        [1.2970913023775286, 103.77357183375999]
      ],
      color: '#2cff05',
      label: `<b>Central Library</b><br>A conducive place for relaxation and studying.<br><b>Stress Rating:</b> ${generateStars(1)}<br><b>Avg time spent:</b> 5 hrs/week<br><img src="images/central-library.jpg" style="width:200px;border-radius:8px;">`,
      hoverColor: '#ff7800'
    },
    {
      coords: [
        [1.2926406682847937, 103.77376019954683],
        [1.2927318139513266, 103.77394258975984],
        [1.2926621143242878, 103.77417325973512],
        [1.2925709686552487, 103.77443075180055],
        [1.2924959075135973, 103.7738084793091]
      ],
      color: '#F54927',
      label: `<b>Mochtar Riady Building</b><br>A glass building where lectures and tutorials are conducted.<br><b>Stress Rating:</b> ${generateStars(5)}<br><b>Avg time spent:</b> 10 hrs/week`,
      hoverColor: '#0000FF'
    }
  ];

  polygons.forEach(p => {
    let poly = L.polygon(p.coords, {color:'#000', fillColor:p.color, fillOpacity:0.6, weight:2}).addTo(map);
    poly.bindPopup(`<div class="custom-popup">${p.label}</div>`);

    poly.on('mouseover', function(){
      this.setStyle({fillColor:p.hoverColor, weight:3});
      this.openPopup();
    });

    poly.on('mouseout', function(){
      this.setStyle({fillColor:p.color, weight:2});
      this.closePopup();
    });
  });

  // Leaflet Draw setup
  var drawnItems = new L.FeatureGroup();
  map.addLayer(drawnItems);

  var drawControl = new L.Control.Draw({
    draw: {
      polygon: {
        allowIntersection: false,
        showArea: true,
        shapeOptions: {
          color: '#FF0000',
          fillColor: '#FFA07A',
          fillOpacity: 0.5
        }
      },
      polyline: false, rectangle:false, circle:false, marker:false, circlemarker:false
    },
    edit: false
  });
  map.addControl(drawControl);

  map.on(L.Draw.Event.CREATED, function(event){
    var layer = event.layer;
    drawnItems.addLayer(layer);

    var latlngs = layer.getLatLngs()[0];
    var formattedCoords = latlngs.map(ll => `[${ll.lat.toFixed(6)}, ${ll.lng.toFixed(6)}]`);
    var result = `[\n  ${formattedCoords.join(',\n  ')}\n]`;

    copyToClipboard(result);
    alert('Polygon drawn! Coordinates copied to clipboard.');
  });

  function copyToClipboard(text){
    navigator.clipboard.writeText(text).then(()=>{showNotice();})
    .catch(err=>alert('Failed to copy: '+err));
  }

  function showNotice(){
    var notice = document.getElementById('copy-notice');
    notice.style.display='block';
    setTimeout(()=>notice.style.display='none',2000);
  }

  document.getElementById('view-infographic').addEventListener('click', ()=>{
    localStorage.setItem('infographicPolygons', JSON.stringify(polygons));
    window.open('infographic.html','_blank');
  });
</script>
</body>
</html>
