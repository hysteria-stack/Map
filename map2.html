<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive Map with Draw + Clipboard</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />

  <style>
    html, body, #map {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #copy-notice {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #4caf50;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-family: sans-serif;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>

<div id="copy-notice">Coordinates copied to clipboard!</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>

<script>
  var map = L.map('map').setView([1.2966, 103.7764], 16);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  // Central Library
  var polygon1 = L.polygon([
    [1.297225707113247, 103.77373337745668],
    [1.2971345616083245, 103.7740069627762],
    [1.2966091345158954, 103.77384066581727],
    [1.296711003042346, 103.77354025840759]
  ], {
    color: '#0000FF',
    fillColor: '#ADD8E6',
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon1.bindPopup(`<b>Central Library</b><br>Stress Rating: ★☆☆☆☆`);

  polygon1.on('mouseover', function () {
    this.setStyle({ fillColor: '#ff7800' });
    this.openPopup();
  });

  polygon1.on('mouseout', function () {
    this.setStyle({ fillColor: '#ADD8E6' });
    this.closePopup();
  });

  //Mochtar Riady Building
  var polygon2 = L.polygon([
  [
    [1.2926406682847937, 103.77376019954683],
    [1.2927318139513266, 103.77394258975984],
    [1.2926621143242878, 103.77417325973512],
    [1.2925709686552487, 103.77443075180055],
    [1.2923297006920422, 103.77452731132509],
    [1.2922760855859792, 103.77439320087433],
    [1.2923618697551127, 103.77413570880891],
    [1.2923404237131124, 103.77404987812042],
    [1.2924959075135973, 103.7738084793091]
  ]
  ], {
    color: '#0000FF',
    fillColor: '#ADD8E6',
    fillOpacity: 0.5,
    weight: 2
  }).addTo(map);

  polygon2.bindPopup(`<b>Mochtar Riady Building</b><br>Stress Rating: ★★★★☆`);

  polygon2.on('mouseover', function () {
    this.setStyle({ fillColor: '#0000FF' });
    this.openPopup();
  });

  polygon2.on('mouseout', function () {
    this.setStyle({ fillColor: '#ADD8E6' });
    this.closePopup();
  });

  // Leaflet Draw Setup
  var drawnItems = new L.FeatureGroup();
  map.addLayer(drawnItems);

  var drawControl = new L.Control.Draw({
    draw: {
      polygon: {
        allowIntersection: false,
        showArea: true,
        shapeOptions: {
          color: '#FF0000',
          fillColor: '#FFA07A',
          fillOpacity: 0.5
        }
      },
      polyline: false,
      rectangle: false,
      circle: false,
      marker: false,
      circlemarker: false
    },
    edit: {
      featureGroup: drawnItems
    }
  });
  map.addControl(drawControl);

  // Handle drawing completion
  map.on(L.Draw.Event.CREATED, function (event) {
    var layer = event.layer;
    drawnItems.addLayer(layer);

    var latlngs = layer.getLatLngs()[0]; // Outer ring of polygon

    // Format coordinates as [lat, lng]
    var formattedCoords = latlngs.map(function(latlng) {
      return `[${latlng.lat}, ${latlng.lng}]`;
    });

    var result = `[\n  ${formattedCoords.join(',\n  ')}\n]`;

    // Copy to clipboard
    copyToClipboard(result);

    // Optional: log to console
    console.log("Copied Polygon Coordinates:\n", result);
  });

  // Clipboard copy function
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function () {
      showNotice();
    }).catch(function (err) {
      alert('Failed to copy coordinates: ' + err);
    });
  }

  // Visual confirmation
  function showNotice() {
    var notice = document.getElementById('copy-notice');
    notice.style.display = 'block';
    setTimeout(() => {
      notice.style.display = 'none';
    }, 2000);
  }
</script>
</body>
</html>
